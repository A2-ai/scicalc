<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>scicalc • scicalc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="scicalc">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scicalc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/scicalc.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/A2-ai/scicalc"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>scicalc</h1>
            
      

      <div class="d-none name"><code>scicalc.Rmd</code></div>
    </div>

    
    
<p>To install the scicalc package you can run the following two
commands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'scicalc'</span> <span class="op">=</span> <span class="st">"https://a2-ai.github.io/gh-pkg-mirror/scicalc"</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"scicalc"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="scicalc">Scicalc<a class="anchor" aria-label="anchor" href="#scicalc"></a>
</h2>
<p>Scicalc is a package of functions commonly used at A2-Ai. We hope
this package will ease data assembly and allow for a more reproducible
code across analysts and projects. It is in no way complete or all
encompassing, but we hope this is a good start. Please let us know if
there are additional functions we should include!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://a2-ai.github.io/scicalc">scicalc</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="reading-in-data">Reading in data<a class="anchor" aria-label="anchor" href="#reading-in-data"></a>
</h3>
<p>I’ll first try and read in data from
<code>~/inst/extdata/data/source</code> - in R packages extra files go
in the <code>inst</code> directory, but we can pretend this is just like
a Project starter <code>data/source</code> directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"inst"</span>, <span class="st">"extdata"</span>, <span class="st">"data"</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dm.sas7bdat"     "lb.csv"          "pc.parquet"      "test_excel.xlsx"</span></span>
<span><span class="co">#&gt; [5] "test.txt"        "vs.parquet"</span></span></code></pre></div>
<p>This is a contrived example, but there are several different file
types in source data representing different SDTM domains. As well as a
<code>test.txt</code> file. We can use the
<code>read_file_with_hash</code> function to read in all the files in
this source directory. No more creating
<code>read_file_type_with_hash</code> functions in each script!</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_source</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="fu">scicalc</span><span class="fu">::</span><span class="va"><a href="../reference/read_file_with_hash.html">read_file_with_hash</a></span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; dm.sas7bdat: 75d8ab73c79e7988ad159b06b23abc8c</span></span>
<span><span class="co">#&gt; lb.csv: b5e4122d4df0ec79401eb6bb0d2d0d85</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">12</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">11</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (4): CREATU, CYSTCU, ASTU, BILIU</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): ID, CREAT, CYSTC, AST, ULNAST, BILI, ULNBILI</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; pc.parquet: fe05aac77074be6b172fa2c13e9acf45</span></span>
<span><span class="co">#&gt; test_excel.xlsx: f665dce4222df738750216bb9cd53819</span></span>
<span><span class="co">#&gt; Sheets in test_excel.xlsx: model_summary, sheet with space, empty</span></span>
<span><span class="co">#&gt; Warning in .f(.x[[i]], ...): File type: txt not currently supported</span></span>
<span><span class="co">#&gt; vs.parquet: ff6d382111f1bd882e33af7dedb0a7f8</span></span></code></pre></div>
<p>These hashes come from <code><a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest::digest</a></code>’s default
algorithm <code>md5</code>, but we can alter this by supplying
<code>algo = 'blake3'</code> to the read_file_with_hash function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_source</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="fu">scicalc</span><span class="fu">::</span><span class="va"><a href="../reference/read_file_with_hash.html">read_file_with_hash</a></span>,</span>
<span>  algo <span class="op">=</span> <span class="st">"blake3"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; dm.sas7bdat: ca1d4db93efdbd31e41b2a2bdead127ca13a2f6cd0aef50672d15f7b955ac662</span></span>
<span><span class="co">#&gt; lb.csv: 577007ecd6292a122b6fdf48add5112ba0976d43db617bb087d8fca07da5b126</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">12</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">11</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (4): CREATU, CYSTCU, ASTU, BILIU</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): ID, CREAT, CYSTC, AST, ULNAST, BILI, ULNBILI</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; pc.parquet: 894693336ec5e4deb6d707613e35e0206edb47858b119c0fb7684d2240ba294b</span></span>
<span><span class="co">#&gt; test_excel.xlsx: 99bf0f59e74683f3173aba85b083dd928f827d6619b01e1afe80dc1830e7859d</span></span>
<span><span class="co">#&gt; Sheets in test_excel.xlsx: model_summary, sheet with space, empty</span></span>
<span><span class="co">#&gt; Warning in .f(.x[[i]], ...): File type: txt not currently supported</span></span>
<span><span class="co">#&gt; vs.parquet: c73eece828a6b0cb4a139b10269d47ba1ce8a134ccf66656b64cc98482eef9d9</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dm"         "lb"         "pc"         "test_excel" "test"      </span></span>
<span><span class="co">#&gt; [6] "vs"</span></span></code></pre></div>
<p>We can see that each different file type was read with
read_file_with_hash and saved to <code>raw_data</code>. We also got a
warning for <code>test.txt</code> file was not currently supported. If
there are any other file types you commonly read and want to print a
hash besides <code>csv</code>, <code>parquet</code>, and
<code>sas7bdat</code> please reach out so we can add that functionality!
Behind the scenes of <code>read_file_with_hash</code> the extension of
the file is determined and a corresponding function such as
<code>read_parquet_with_hash</code> is called. You can call either, but
I would recommend using the general
<code>read_file_with_hash</code>.</p>
</div>
<div class="section level3">
<h3 id="simple-data-analysis">Simple data analysis<a class="anchor" aria-label="anchor" href="#simple-data-analysis"></a>
</h3>
<p>Let’s do some bmi and bsa caclulations with the data in the vs
domain</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">pc</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">vs</span>,</span>
<span>    BBMI <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/bmi.html">bmi</a></span><span class="op">(</span><span class="va">WEIGHT</span>, <span class="va">HEIGHT</span><span class="op">)</span>,</span>
<span>    DBSA <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/bsa.html">bsa</a></span><span class="op">(</span><span class="va">WEIGHT</span>, <span class="va">HEIGHT</span><span class="op">)</span>,</span>
<span>    MBSA <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/bsa.html">bsa</a></span><span class="op">(</span><span class="va">WEIGHT</span>, <span class="va">HEIGHT</span>, method <span class="op">=</span> <span class="st">"mosteller"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 8</span></span></span>
<span><span class="co">#&gt;    ID    HEIGHT WEIGHT    DV  NTLD  BBMI  DBSA  MBSA</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1        174     70    10  0     23.1  1.84  1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1        174     70   150  0.25  23.1  1.84  1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1        174     70    70  1     23.1  1.84  1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1        174     70     9  8     23.1  1.84  1.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2        201     80     7  0     19.8  2.16  2.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2        201     80   140  0.25  19.8  2.16  2.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2        201     80    60  1     19.8  2.16  2.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2        201     80     7  8     19.8  2.16  2.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3        190     75    11  0     20.8  2.02  1.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3        190     75   156  0.25  20.8  2.02  1.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 3        190     75    70  1     20.8  2.02  1.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 3        190     75     7  8     20.8  2.02  1.99</span></span></code></pre></div>
<p>Now we can verify the lab units before moving on - remember this is a
contrived dataset, but the workflow should be somewhat similar.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dflb</span> <span class="op">&lt;-</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">lb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"CREAT"</span>, <span class="st">"CYSTC"</span>, <span class="st">"AST"</span>, <span class="st">"BILI"</span>, <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CREAT"</span>, <span class="st">"CYSTC"</span>, <span class="st">"AST"</span>, <span class="st">"BILI"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"LBTESTCD"</span>, values_to <span class="op">=</span> <span class="st">"LBORRES"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dfu</span> <span class="op">&lt;-</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">lb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"CREATU"</span>, <span class="st">"CYSTCU"</span>, <span class="st">"ASTU"</span>, <span class="st">"BILIU"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CREATU"</span>, <span class="st">"CYSTCU"</span>, <span class="st">"ASTU"</span>, <span class="st">"BILIU"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"LBTESTCDU"</span>, values_to <span class="op">=</span> <span class="st">"LBORRESU"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lb</span> <span class="op">&lt;-</span> <span class="va">dflb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>LBORRESU <span class="op">=</span> <span class="va">dfu</span><span class="op">$</span><span class="va">LBORRESU</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lb</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 4</span></span></span>
<span><span class="co">#&gt;       ID LBTESTCD LBORRES LBORRESU</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 CREAT        1   mg/dL   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 CYSTC        0.4 mg/L    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1 AST         15   U/L     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     1 BILI         0.8 mg/dL   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2 CREAT        4   mg/dL   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2 CYSTC        0.9 mg/L    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     2 AST         29   U/L     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     2 BILI         1.9 mg/dL   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     3 CREAT        3   mg/dL   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     3 CYSTC        0.7 mg/L    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     3 AST         38   U/L     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     3 BILI         1.1 mg/dL</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/check_for_unique_units.html">check_for_unique_units</a></span><span class="op">(</span><span class="va">lb</span><span class="op">$</span><span class="va">LBTESTCD</span>, <span class="va">lb</span><span class="op">$</span><span class="va">LBORRESU</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Units are 1:1!"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Error with units!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Units are 1:1!"</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/get_unique_units_df.html">get_unique_units_df</a></span><span class="op">(</span><span class="va">lb</span><span class="op">$</span><span class="va">LBTESTCD</span>, <span class="va">lb</span><span class="op">$</span><span class="va">LBORRESU</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PARAM  UNIT</span></span>
<span><span class="co">#&gt; 1 CREAT mg/dL</span></span>
<span><span class="co">#&gt; 2 CYSTC  mg/L</span></span>
<span><span class="co">#&gt; 3   AST   U/L</span></span>
<span><span class="co">#&gt; 4  BILI mg/dL</span></span></code></pre></div>
<p>Now we can use the lab data to calculate hepatic function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">lb</span>,</span>
<span>    BHFC <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/hfc.html">hfc</a></span><span class="op">(</span><span class="va">AST</span>, <span class="va">ULNAST</span>, <span class="va">BILI</span>, <span class="va">ULNBILI</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 19</span></span></span>
<span><span class="co">#&gt;    ID    CREAT CREATU CYSTC CYSTCU   AST ULNAST  BILI ULNBILI ASTU  BILIU HEIGHT</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         1 mg/dL    0.4 mg/L      15     33   0.8     1.2 U/L   mg/dL    174</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         1 mg/dL    0.4 mg/L      15     33   0.8     1.2 U/L   mg/dL    174</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1         1 mg/dL    0.4 mg/L      15     33   0.8     1.2 U/L   mg/dL    174</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1         1 mg/dL    0.4 mg/L      15     33   0.8     1.2 U/L   mg/dL    174</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2         4 mg/dL    0.9 mg/L      29     33   1.9     1.2 U/L   mg/dL    201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2         4 mg/dL    0.9 mg/L      29     33   1.9     1.2 U/L   mg/dL    201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2         4 mg/dL    0.9 mg/L      29     33   1.9     1.2 U/L   mg/dL    201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2         4 mg/dL    0.9 mg/L      29     33   1.9     1.2 U/L   mg/dL    201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3         3 mg/dL    0.7 mg/L      38     33   1.1     1.2 U/L   mg/dL    190</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3         3 mg/dL    0.7 mg/L      38     33   1.1     1.2 U/L   mg/dL    190</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 3         3 mg/dL    0.7 mg/L      38     33   1.1     1.2 U/L   mg/dL    190</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 3         3 mg/dL    0.7 mg/L      38     33   1.1     1.2 U/L   mg/dL    190</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: WEIGHT &lt;dbl&gt;, DV &lt;dbl&gt;, NTLD &lt;dbl&gt;, BBMI &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   DBSA &lt;dbl&gt;, MBSA &lt;dbl&gt;, BHFC &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we’ll need the demographics needed for Creatinine clearance,
estimated glomerular filtration rate, and renal function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="va">raw_data</span><span class="op">$</span><span class="va">dm</span>,</span>
<span>    CRCL <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/crcl.html">crcl</a></span><span class="op">(</span><span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_female.html">is_female</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span>, <span class="va">AGE</span>, <span class="va">CREAT</span>, <span class="va">WEIGHT</span><span class="op">)</span>,</span>
<span>    ckdepi_2009_egfr <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/egfr.html">egfr</a></span><span class="op">(</span></span>
<span>      sexf <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_female.html">is_female</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span>,</span>
<span>      raceb <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_black.html">is_black</a></span><span class="op">(</span><span class="va">RACE</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>      creat <span class="op">=</span> <span class="va">CREAT</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"CKDEPI 2009"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    ckdepi_2021_egfr <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/egfr.html">egfr</a></span><span class="op">(</span></span>
<span>      sexf <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_female.html">is_female</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>      creat <span class="op">=</span> <span class="va">CREAT</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"CKDEPI 2021"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    ckdepi_2021_egfr_cystatin <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/egfr.html">egfr</a></span><span class="op">(</span></span>
<span>      sexf <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_female.html">is_female</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>      creat <span class="op">=</span> <span class="va">CREAT</span>,</span>
<span>      cystc <span class="op">=</span> <span class="va">CYSTC</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"CKDEPI 2021 CYSTATIN"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    mdrd_egfr <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/egfr.html">egfr</a></span><span class="op">(</span></span>
<span>      sexf <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_female.html">is_female</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span>,</span>
<span>      raceb <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/is_black.html">is_black</a></span><span class="op">(</span><span class="va">RACE</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>      creat <span class="op">=</span> <span class="va">CREAT</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"MDRD"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    schwartz_egfr <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/egfr.html">egfr</a></span><span class="op">(</span></span>
<span>      height <span class="op">=</span> <span class="va">HEIGHT</span>,</span>
<span>      creat <span class="op">=</span> <span class="va">CREAT</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"Schwartz"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    BSA <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/bsa.html">bsa</a></span><span class="op">(</span><span class="va">WEIGHT</span>, <span class="va">HEIGHT</span><span class="op">)</span>,</span>
<span>    BRFC <span class="op">=</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/rfc.html">rfc</a></span><span class="op">(</span><span class="va">ckdepi_2009_egfr</span>, bsa <span class="op">=</span> <span class="va">BSA</span>, absolute_units <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 30</span></span></span>
<span><span class="co">#&gt;    ID    SEX   RACE    AGE CREAT CREATU CYSTC CYSTCU   AST ULNAST  BILI ULNBILI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: ASTU &lt;chr&gt;, BILIU &lt;chr&gt;, HEIGHT &lt;dbl&gt;, WEIGHT &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   DV &lt;dbl&gt;, NTLD &lt;dbl&gt;, BBMI &lt;dbl&gt;, DBSA &lt;dbl&gt;, MBSA &lt;dbl&gt;, BHFC &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CRCL &lt;dbl&gt;, ckdepi_2009_egfr &lt;dbl&gt;, ckdepi_2021_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ckdepi_2021_egfr_cystatin &lt;dbl&gt;, mdrd_egfr &lt;dbl&gt;, schwartz_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BSA &lt;dbl&gt;, BRFC &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="writting-data">Writting data<a class="anchor" aria-label="anchor" href="#writting-data"></a>
</h3>
<p>We can use the <code>write_file_with_hash</code> to write
<code>parquet</code> files (We highly recommend you write all data to
parquet unless there is a specific need for other file type). We just
need to supply a path to the file if the directory the file should be
written to does not exist, this function will create it and all
directories needed on the path. This function won’t let us overwrite the
file unless we supply <code>overwrite = TRUE</code>. Like
<code>read_file_with_hash</code> we can choose which algorithm to use
for the digest.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_derived</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"inst"</span>, <span class="st">"extdata"</span>, <span class="st">"data"</span>, <span class="st">"derived"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/write_file_with_hash.html">write_file_with_hash</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>,</span>
<span>    algo <span class="op">=</span> <span class="st">"blake3"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Overwriting data!"</span><span class="op">)</span></span>
<span>  <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/write_file_with_hash.html">write_file_with_hash</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="cn">TRUE</span>, algo <span class="op">=</span> <span class="st">"blake3"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Overwriting data!"</span></span>
<span><span class="co">#&gt; /home/runner/work/scicalc/scicalc/inst/extdata/data/derived/pk_data_v01.parquet: 1e6d74bffa0f1a2f9627872aa63403cd7a34ea7be9798eaab489f1fe401a619a</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reading-in-derived-data">Reading in derived data<a class="anchor" aria-label="anchor" href="#reading-in-derived-data"></a>
</h3>
<p>Now if we want to read in the derived data and verify it is the data
we think it is we can use <code>read_hashed_file</code>. This function
will only let you ingest the data if the hash you supply matches the
hash of the contents of the file. Here I’ve supplied the
<code>blake3</code> hash which does not match the <code>md5</code> hash
digest uses by default. We have two options, tell
<code>read_hashed_file</code> to use <code>algo = 'blake3'</code> or
supply the <code>md5</code> hash.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hash</span> <span class="op">&lt;-</span> <span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span><span class="op">)</span> <span class="co"># This is a hash of the string to the file type so it will not match the hash for contents of the file.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hash</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "16719721ab4cf192479f02ae956dc51b"</span></span>
<span><span class="co"># This hash is incorrect so the function errors</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span><span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/read_hashed_file.html">read_hashed_file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>, <span class="va">hash</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>updated algo argument works:</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correct_hash</span> <span class="op">&lt;-</span> <span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>, algo <span class="op">=</span> <span class="st">"blake3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">correct_hash</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1e6d74bffa0f1a2f9627872aa63403cd7a34ea7be9798eaab489f1fe401a619a"</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/read_hashed_file.html">read_hashed_file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>,</span>
<span>  algo <span class="op">=</span> <span class="st">"blake3"</span>,</span>
<span>  <span class="va">correct_hash</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 30</span></span></span>
<span><span class="co">#&gt;    ID    SEX   RACE    AGE CREAT CREATU CYSTC CYSTCU   AST ULNAST  BILI ULNBILI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: ASTU &lt;chr&gt;, BILIU &lt;chr&gt;, HEIGHT &lt;dbl&gt;, WEIGHT &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   DV &lt;dbl&gt;, NTLD &lt;dbl&gt;, BBMI &lt;dbl&gt;, DBSA &lt;dbl&gt;, MBSA &lt;dbl&gt;, BHFC &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CRCL &lt;dbl&gt;, ckdepi_2009_egfr &lt;dbl&gt;, ckdepi_2021_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ckdepi_2021_egfr_cystatin &lt;dbl&gt;, mdrd_egfr &lt;dbl&gt;, schwartz_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BSA &lt;dbl&gt;, BRFC &lt;dbl&gt;</span></span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>giving the <code>md5</code> hash works</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">md5_hash</span> <span class="op">&lt;-</span> <span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">md5_hash</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fe2e4c0564cfd5099a3fa1cb38b10283"</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">scicalc</span><span class="fu">::</span><span class="fu"><a href="../reference/read_hashed_file.html">read_hashed_file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_derived</span>, <span class="st">"pk_data_v01.parquet"</span><span class="op">)</span>,</span>
<span>  <span class="va">md5_hash</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 30</span></span></span>
<span><span class="co">#&gt;    ID    SEX   RACE    AGE CREAT CREATU CYSTC CYSTCU   AST ULNAST  BILI ULNBILI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     F     WHITE    24     1 mg/dL    0.4 mg/L      15     33   0.8     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     M     BLACK    22     4 mg/dL    0.9 mg/L      29     33   1.9     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 3     F     ASIAN    35     3 mg/dL    0.7 mg/L      38     33   1.1     1.2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more variables: ASTU &lt;chr&gt;, BILIU &lt;chr&gt;, HEIGHT &lt;dbl&gt;, WEIGHT &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   DV &lt;dbl&gt;, NTLD &lt;dbl&gt;, BBMI &lt;dbl&gt;, DBSA &lt;dbl&gt;, MBSA &lt;dbl&gt;, BHFC &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CRCL &lt;dbl&gt;, ckdepi_2009_egfr &lt;dbl&gt;, ckdepi_2021_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ckdepi_2021_egfr_cystatin &lt;dbl&gt;, mdrd_egfr &lt;dbl&gt;, schwartz_egfr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BSA &lt;dbl&gt;, BRFC &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Smith, Jenna Johnson, Devin Pastoor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
